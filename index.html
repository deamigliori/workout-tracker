<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* ... [Mantenha todo o CSS anterior] ... */

        .save-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .save-button:hover {
            background-color: #45a049;
        }

        .save-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        /* Mensagens de feedback */
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 4px;
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            z-index: 1000;
        }

        .success {
            background-color: #4caf50;
            opacity: 1;
        }

        .error {
            background-color: #f44336;
            opacity: 1;
        }

        .loading {
            background-color: #2196f3;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- [Mantenha todo o HTML da estrutura da tabela anterior] -->
        <button id="saveButton" class="save-button">Salvar Alterações</button>
    </div>
    <div id="message" class="message"></div>

    <script>
        let currentData = {};
        let hasUnsavedChanges = false;

        // Função para mostrar mensagens
        function showMessage(text, type) {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = `message ${type}`;
            setTimeout(() => {
                message.className = 'message';
            }, 3000);
        }

        // Carregar dados do arquivo data.json
        async function loadData() {
            try {
                showMessage('Carregando dados...', 'loading');
                const response = await fetch('data.json');
                if (!response.ok) {
                    throw new Error('Erro ao carregar dados');
                }
                const data = await response.json();
                currentData = data.workoutData || {};
                showMessage('Dados carregados com sucesso!', 'success');
                return currentData;
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showMessage('Erro ao carregar dados', 'error');
                return {};
            }
        }

        // Atualizar interface baseado nos dados
        function updateInterface() {
            const rows = document.querySelectorAll('#workoutTable tbody tr');
            rows.forEach(row => {
                const participant = row.dataset.participant;
                const inputs = row.querySelectorAll('input[type="number"]');
                inputs.forEach((input, index) => {
                    input.value = currentData[participant]?.[index] || 0;
                });
            });
            updateTotalsAndRankings();
        }

        // Função para salvar dados localmente
        function updateLocalData(participant, weekIndex, value) {
            if (!currentData[participant]) {
                currentData[participant] = {};
            }
            currentData[participant][weekIndex] = parseInt(value);
            hasUnsavedChanges = true;
            document.getElementById('saveButton').disabled = false;
        }

        // Download dos dados como arquivo JSON
        function downloadData() {
            const dataStr = JSON.stringify({ workoutData: currentData }, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'data.json';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            showMessage('Dados exportados com sucesso!', 'success');
            hasUnsavedChanges = false;
            document.getElementById('saveButton').disabled = true;
        }

        // Atualizar a função updateWorkouts
        function updateWorkouts(input) {
            const newValue = Math.max(0, Math.min(3, parseInt(input.value) || 0));
            input.value = newValue;
            
            const row = input.closest('tr');
            const participant = row.dataset.participant;
            const weekIndex = Array.from(row.cells).indexOf(input.closest('td'));
            
            updateLocalData(participant, weekIndex, newValue);
            updateTotalsAndRankings();
        }

        // Inicialização
        async function initialize() {
            await loadData();
            updateInterface();
            
            // Configurar botão de salvar
            const saveButton = document.getElementById('saveButton');
            saveButton.disabled = !hasUnsavedChanges;
            saveButton.addEventListener('click', downloadData);
        }

        // Carregar dados quando a página iniciar
        window.onload = initialize;

        // Aviso antes de sair da página com alterações não salvas
        window.onbeforeunload = function(e) {
            if (hasUnsavedChanges) {
                e.preventDefault();
                return 'Você tem alterações não salvas. Deseja realmente sair?';
            }
        };
    </script>
</body>
</html>
